<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Code Prettier - 코드 변환 도구</title>
  <meta name="description" content="기존 코드를 새로운 코드로 변환하고 차이점을 시각적으로 확인할 수 있는 도구">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg">
  <link rel="stylesheet" href="assets/css/common.css">
  <link rel="stylesheet" href="assets/css/site-ui.css">
  
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(145deg, 
        #2E3192 0%, 
        #1BFFFF 100%
      );
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    /* iOS 스타일 블러 효과 */
    .code-panel {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    /* iOS 스타일 입력 필드 */
    .glass-form-element {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* iOS 스타일 버튼 */
    .glass-btn-orange {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .glass-btn-orange:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }

    /* 커스텀 툴팁 스타일 */
    [data-tooltip] {
      position: relative;
    }
    
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 1000;
      pointer-events: none;
    }
    
         [data-tooltip]:hover::before {
       content: '';
       position: absolute;
       bottom: 112%;
       left: 50%;
       transform: translateX(-50%);
       border: 4px solid transparent;
       border-top-color: rgba(0, 0, 0, 0.8);
       z-index: 1000;
       pointer-events: none;
     }
     
     /* 수동입력 버튼 호버 효과 */
     #manualInputBtn:hover {
       transform: translateY(-1px);
       box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
     }
     
     /* 기본 상태 (흰색) 호버 */
     #manualInputBtn[style*="background: white"]:hover {
       background: #f8f9fa !important;
       border-color: #adb5bd !important;
     }
     
     /* 토글 상태 (연한 회색) 호버 */
     #manualInputBtn[style*="#f8f9fa"]:hover {
       background: #e9ecef !important;
       border-color: #adb5bd !important;
     }
     
     /* Liquid Glass 애니메이션 */
     @keyframes pulse {
       0%, 100% { 
         transform: scale(1); 
         opacity: 1; 
       }
       50% { 
         transform: scale(1.1); 
         opacity: 0.8; 
       }
     }
     
     @keyframes shimmer {
       0% { transform: translateX(-100%); }
       100% { transform: translateX(100%); }
     }
     
     @keyframes glow {
       0%, 100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.2); }
       50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.4); }
     }
     
     /* 예시 코드 블록 스타일 */
     .glass-example-before pre,
     .glass-example-after pre {
       margin: 0;
       padding: 0;
       background: none;
       border: none;
       font-family: 'Courier New', monospace;
       font-size: 14px;
       line-height: 1.6;
       white-space: pre;
       overflow-x: auto;
     }

     /* 찾기/바꾸기 항목 스타일 */
     .glass-find-replace-item {
       background: rgba(255, 255, 255, 0.05);
       border: 1px solid rgba(255, 255, 255, 0.1);
       border-radius: 8px;
       padding: 12px;
       margin: 8px 0;
     }

     .glass-find-replace-item-content {
       display: flex;
       align-items: center;
       gap: 12px;
     }

     .glass-find-replace-item-find,
     .glass-find-replace-item-replace {
       background: rgba(255, 255, 255, 0.1);
       padding: 6px 10px;
       border-radius: 4px;
       font-family: monospace;
       font-size: 13px;
       flex: 1;
       border: 1px solid rgba(255, 255, 255, 0.2);
       color: rgba(255, 255, 255, 0.9);
       outline: none;
     }

     .glass-find-replace-item-find:focus,
     .glass-find-replace-item-replace:focus {
       background: rgba(255, 255, 255, 0.15);
       border-color: rgba(255, 255, 255, 0.3);
     }

     .glass-find-replace-item .btn-remove {
       background: none;
       color: rgba(255, 255, 255, 0.6);
       cursor: pointer;
       padding: 4px;
       font-size: 14px;
       transition: all 0.2s ease;
       margin: 0;
       width: 30px;
       height: 30px;
       border-radius: 8px;
     }

     .glass-find-replace-item .btn-remove:hover {
       color: rgba(255, 255, 255, 0.9);
       transform: scale(1.1);
     }

     /* 찾기/바꾸기 추가 버튼 스타일 */
     .glass-btn-add {
       color: rgba(255, 255, 255, 0.9);
       padding: 8px 16px;
       border-radius: 8px;
       cursor: pointer;
       transition: all 0.2s ease;
       display: inline-flex;
       align-items: center;
       gap: 6px;
       margin: 0;
       justify-content: center;
       font-size: 20px;
       font-weight: normal;
       border: 1px solid rgba(255, 255, 255, 0.2);
       background: rgba(255, 255, 255, 0.1);
     }

     .glass-btn-add:hover {
       background: rgba(100, 255, 218, 0.15);
       border-color: rgba(100, 255, 218, 0.3);
       transform: translateY(-1px);
     }

     .glass-btn-add:active {
       transform: translateY(0);
     }

     /* 직접 수정 가능한 결과 코드 스타일 */
     #newCode:not([readonly]) {
       background: rgba(255, 255, 255, 0.05);
       border: 1px solid rgba(255, 255, 255, 0.2);
     }

     /* 변경점 비교 스타일 */
     .diff-content {
       padding: 15px;
       background: rgba(255, 255, 255, 0.05);
       border-radius: 0 0 12px 12px;
     }

     .diff-line {
       font-family: monospace;
       white-space: pre-wrap;
       word-break: break-all;
       line-height: 1.5;
       font-size: 13px;
       display: flex;
     }

     .diff-mark {
       flex-shrink: 0;
       width: 20px;
       color: rgba(255, 255, 255, 0.5);
     }

     .diff-text {
       flex: 1;
       min-width: 0;
     }

     .diff-line.removed {
       background: rgba(255, 82, 82, 0.5);
       color: #fff;
     }

     .diff-line.added {
       background: rgba(100, 255, 167, 0.5);
       color: #fff;
     }

     /* 변경점 통계 스타일 */
     .stats {
       display: flex;
       gap: 16px;
       align-items: center;
       margin-left: auto;
       border-radius: 6px;
     }

     .stat-item {
       display: flex;
       align-items: center;
       gap: 6px;
       font-size: 13px;
       color: rgba(255, 255, 255, 0.8);
     }

     .stat-number {
       font-weight: bold;
       color: white;
       line-height: 1;
     }

     .glass-highlight-green,
     .glass-highlight-red {
       color: #fff;
       line-height: 1;
     }

     /* 결과 패널 스타일 */
     .result-content {
       padding: 15px;
       background: rgba(255, 255, 255, 0.05);
       border-radius: 0 0 12px 12px;
     }

     .result-content pre.glass-code-text {
       margin: 0;
       font-family: monospace;
       white-space: pre-wrap;
       word-break: break-all;
       line-height: 1.5;
       font-size: 13px;
     }

     /* 복사 버튼 스타일 */
     .copy-btn-sm {
       background: none;
       border: 1px solid rgba(255, 255, 255, 0.2);
       color: rgba(255, 255, 255, 0.9);
       padding: 4px 12px;
       border-radius: 6px;
       font-size: 12px;
       cursor: pointer;
       transition: all 0.2s ease;
     }

     .copy-btn-sm:hover {
       background: rgba(255, 255, 255, 0.1);
       border-color: rgba(255, 255, 255, 0.3);
     }

     .copy-btn-sm.copied {
       background: rgba(100, 255, 167, 0.2);
       border-color: rgba(100, 255, 167, 0.3);
     }
   </style>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <div class="header-center">
        <div class="logo">
          <a href="index.html">
            <img src="assets/images/logo.png" alt="Adapt Style Guide">
          </a>
        </div>
      </div>
      <nav class="main-nav">
        <ul>
          <li><a href="index.html">UI 컴포넌트</a></li>
          <li><a href="custom-guide.html">커스텀 엘리먼트 가이드</a></li>
          <li><a href="code-prettier.html" class="active">Code Prettier</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="prettier-container">
    <div class="transform-controls">
      <div class="preset-buttons">
        <button class="btn-preset" onclick="setPreset('selective', this)">🎯 선택적 변경</button>
        <button class="btn-preset" onclick="setPreset('date', this)">📅 날짜 변경</button>
        <button class="btn-preset" onclick="setPreset('image', this)">📷 이미지 경로 변경</button>
      </div>
      
      <!-- 정규식 패턴 설명 -->
      <div class="glass-settings-box">
        <div class="glass-text-14"><strong>💡 정규식 패턴 설명</strong></div>
        <div class="glass-code-text">
          <div><strong>찾을 텍스트:</strong> <code>/250617\/(01|02|03|04)\.(jpg|png)/g</code></div>
          <div class="glass-text-6"><strong>바꿀 텍스트 예시:</strong> <code>250701</code></div>
          <div class="glass-text-8">
            <span class="glass-highlight-red">$1 = 파일번호 (01|02|03|04)</span> 
            <span class="glass-highlight-green" style="margin-left: 8px;">$2 = 확장자 (jpg|png)</span>
          </div>
        </div>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 24px;">
        <div class="control-group">
          <label for="findText">찾을 텍스트 (정규식 지원)</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" id="findText" placeholder="예: /250617\/(23|25)\.(jpg|png)/g" autocomplete="off" style="flex: 1;" />
            <button class="glass-btn-add" onclick="addFindReplace()" style="padding: 8px; width: 36px; height: 36px;" data-tooltip="찾기/바꾸기 추가">
              +
            </button>
          </div>
        </div>
        <div class="control-group">
          <label for="replaceText">바꿀 텍스트</label>
          <input type="text" id="replaceText" placeholder="예: 250701" autocomplete="off" />
        </div>
      </div>

      <!-- 추가된 찾기/바꾸기 항목들 -->
      <div id="additionalFindReplace" class="glass-settings-box" style="display: none; margin: 15px 0;"></div>
      
      <div class="control-buttons" style="display: none">
        <button class="btn-glass" onclick="clearAll()">
          전체 초기화
        </button>
        <button class="btn-glass" onclick="transformCode()">
          코드 변환
        </button>
      </div>
    </div>

    <div class="prettier-main">
      <div class="code-panel">
        <div class="panel-header">
          기존 코드
          <span class="badge">Original</span>
        </div>
        
        <!-- 컨트롤 영역 -->
        <div class="glass-settings-box">
          <div style="display: flex; gap: 10px; align-items: stretch;">
            <button onclick="toggleManualInput()" id="manualInputBtn" class="glass-btn-manual" data-tooltip="수동 입력">
                ✏️
            </button>  
            <div style="flex-grow: 1; display: flex; gap: 10px;">
              <input type="text" id="pageUrl" autocomplete="off" placeholder="@ URL 입력 (예: https://95problems.com/product/...)" class="glass-form-element" style="flex-grow: 1;">
              <select id="pageUrlSelect" class="glass-form-element" style="display: none; flex-grow: 1;">
                <option value="">🌐 사이트를 선택하세요</option>
                <option value="https://8apm.co.kr">8apm.co.kr</option>
                <option value="https://95problems.com">95problems.com</option>
                <option value="https://duorexin.com">duorexin.com</option>
                <option value="https://full-y.co.kr">full-y.co.kr</option>
                <option value="https://food-ology.co.kr">food-ology.co.kr</option>
                <option value="https://obge.co.kr">obge.co.kr</option>
              </select>
            </div>
            <!-- 자동 입력 버튼 -->
            <div id="autoControls" style="display: flex; gap: 10px;">
              <button onclick="fetchPageContent()" id="fetchBtn" class="btn-proxy glass-btn-orange">
                🚀 자동 가져오기
              </button>
              <button onclick="previewCode()" id="previewBtn" class="btn-preview">
                ✨ 미리보기
              </button>
            </div>
            <!-- 수동 입력 버튼 -->
            <div id="manualControls" style="display: none; gap: 10px;">
              <button onclick="transformCode()" class="btn-proxy glass-btn-orange">
                ⚡ 코드 변환하기
              </button>
              <button onclick="previewCode()" class="btn-preview">
                ✨ 미리보기
              </button>
            </div>
          </div>
          <small class="glass-small-text">
            💡 URL 입력 → 프록시로 자동 가져오기 또는 직접 코드 입력 후 미리보기
          </small>
        </div>
        
        <textarea 
          class="code-textarea" 
          id="originalCode" 
          placeholder="기존 코드를 여기에 붙여넣으세요...&#10;&#10;또는 위의 URL 입력 기능을 사용하세요&#10;&#10;예시:&#10;<img src='/images/old/logo.png' alt='로고'>&#10;<div class='old-class'>내용</div>"
          oninput="handleCodeInput(this.value)"
        ></textarea>
      </div>
      
      <div class="code-panel">
        <div class="panel-header">
          새로운 코드
          <span class="badge glass-highlight-green">Modified</span>
        </div>
        <textarea 
          class="code-textarea" 
          id="newCode" 
          placeholder="변환된 코드가 여기에 표시됩니다..."
          readonly
          style="height: 505px;"
          oninput="showDiff(document.getElementById('originalCode').value, this.value)"
        ></textarea>
      </div>
    </div>

    <div class="diff-panel">
      <div class="panel-header">
        변경점 비교
        <div class="stats" id="diffStats" style="display: none; margin-bottom: 0">
          <div class="stat-item">
            <span class="glass-highlight-green">+</span>
            <span class="stat-number" id="addedLines">0</span>
            <span>추가</span>
          </div>
          <div class="stat-item">
            <span class="glass-highlight-red">-</span>
            <span class="stat-number" id="removedLines">0</span>
            <span>삭제</span>
          </div>
        </div>
      </div>
      <div class="diff-content" id="diffContent">
        여기에서 변경점을 확인할 수 있습니다.
      </div>
    </div>

    <div class="result-panel">
      <div class="panel-header">
        최종 결과
        <button class="copy-btn-sm" onclick="copyResult()">
          복사
        </button>
      </div>
      <div class="result-content" id="resultContent">
        변환된 최종 코드가 여기에 표시됩니다.
      </div>
    </div>

    <!-- 사용 예시 섹션 -->
    <div class="result-panel" style="margin-top: 40px;">
      <div class="panel-header">
        <h3 class="glass-heading">사용 예시</h3>
      </div>
      
      <div style="background: rgba(255, 255, 255, 0.05); border-radius: 0 0 12px 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); padding: 30px; backdrop-filter: blur(20px);">
        <!-- 예시 1: 선택적 변경 -->
        <div class="example-section" style="margin-bottom: 40px;">
          <h3 style="margin-bottom: 15px;">선택적 변경 예시</h3>
          <p class="glass-paragraph">23번과 25번 이미지만 날짜를 250617에서 250701로 변경하는 경우</p>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
              <div class="glass-example-before">
                <h4>변경 전</h4>
                <pre class="glass-text-white">&lt;div class="product_detail_wrap"&gt;
  &lt;img src="/img/detail/P000000L/<span class="glass-highlight-red">250617</span>/22.jpg"&gt;
  &lt;img src="/img/detail/P000000L/<span class="glass-highlight-red">250617</span>/23.jpg"&gt;
  &lt;img src="/img/detail/P000000L/<span class="glass-highlight-red">250617</span>/24.jpg"&gt;
  &lt;img src="/img/detail/P000000L/<span class="glass-highlight-red">250617</span>/25.jpg"&gt;
&lt;/div&gt;</pre>
              </div>
            </div>
            
            <div>
              <div class="glass-example-after">
                <h4>변경 후</h4>
                <pre class="glass-text-white">&lt;div class="product_detail_wrap"&gt;
  &lt;img src="/img/detail/P000000L/250617/22.jpg"&gt;
  &lt;img src="/img/detail/P000000L/<span class="glass-highlight-green">250701</span>/23.jpg"&gt;
  &lt;img src="/img/detail/P000000L/250617/24.jpg"&gt;
  &lt;img src="/img/detail/P000000L/<span class="glass-highlight-green">250701</span>/25.jpg"&gt;
&lt;/div&gt;</pre>
              </div>
            </div>
          </div>
          
          <div class="glass-settings-box">
            <h4>설정값</h4>
            <div class="glass-monospace">
              <div><strong>찾을 텍스트:</strong> <code>/250617\/(23|25)\.(jpg|png)/g</code></div>
              <div><strong>바꿀 텍스트:</strong> <code>250701/$1.$2</code></div>
            </div>
          </div>
        </div>

        <!-- 사용 팁 -->
        <div class="glass-settings-box">
          <h4>💡 사용 팁</h4>
          <ul class="glass-text-tip">
            <li><strong>정규식 활용:</strong> 복잡한 패턴은 정규식으로 처리 (예: <code>/old\d+/g</code>)</li>
            <li><strong>백업 필수:</strong> 대량 변경 전에는 반드시 원본 코드를 백업하세요</li>
            <li><strong>단계별 테스트:</strong> 작은 부분부터 테스트 후 전체 적용</li>
            <li><strong>미리보기 확인:</strong> 변환 결과를 반드시 확인 후 복사</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- 플로팅 비메오 버튼 -->
  <button class="floating-btn floating-vimeo-btn" onclick="document.getElementById('vimeoGeneratorModal').open()" title="비메오 코드 생성기">
    <span>비메오 코드 생성기</span>
  </button>

  <!-- 비메오 코드 생성기 모달 -->
  <site-modal id="vimeoGeneratorModal">
    <div class="modal-header">
      <h3>비메오 코드 생성기</h3>
      <button class="usage-guide-close" onclick="document.getElementById('vimeoGeneratorModal').close()" aria-label="닫기">&times;</button>
    </div>
    <div class="modal-body">
      <!-- 사용법 가이드 -->
      <div class="vimeo-guide">
        <h4 style="margin: 0 0 10px 0; font-size: 16px;">비메오 다이렉트 링크 가져오는 방법</h4>
        <div class="guide-steps" style="font-size: 14px; line-height: 1.6; display: none;">
          <p style="margin: 8px 0;"><strong>1.</strong> 라이브러리에서 동영상을 엽니다</p>
          <p style="margin: 8px 0;"><strong>2.</strong> 동영상 설정 페이지의 오른쪽 상단 모서리에 있는 <strong>옵션 메뉴 (…)</strong>를 선택합니다</p>
          <p style="margin: 8px 0;"><strong>3.</strong> <strong>Video file links</strong>를 선택합니다</p>
          <p style="margin: 8px 0;"><strong>4.</strong> 모달 창의 드롭다운 메뉴에서 <strong>Play The Video</strong>를 선택합니다</p>
          <p style="margin: 8px 0;"><strong>5.</strong> 가져오려는 화질의 <strong>Copy Link</strong>를 선택합니다</p>
          <p style="margin: 8px 0;"><strong>6.</strong> 복사된 링크를 아래 입력창에 붙여넣기하고 코드를 생성하세요</p>
        </div>
                        <button onclick="toggleVimeoGuide()" class="glass-btn-underline">
          가이드 펼치기
        </button>
      </div>
      
      <div class="vimeo-generator">
        <label for="vimeoUrl">비메오 링크를 붙여넣으세요:</label>
        <input type="url" id="vimeoUrl" placeholder="https://player.vimeo.com/progressive_redirect/playbook/..." autocomplete="off" class="glass-input-url">
        
        <div class="vimeo-options">
          <label style="display: flex; align-items: center; margin: 10px 0;">
            <input type="checkbox" id="vimeoMuted" checked style="margin-right: 8px;">
            음소거 (muted)
          </label>
          <label style="display: flex; align-items: center; margin: 10px 0;">
            <input type="checkbox" id="vimeoAutoplay" checked style="margin-right: 8px;">
            자동재생 (autoplay)
          </label>
          <label style="display: flex; align-items: center; margin: 10px 0;">
            <input type="checkbox" id="vimeoLoop" checked style="margin-right: 8px;">
            반복재생 (loop)
          </label>
          <label style="display: flex; align-items: center; margin: 10px 0;">
            <input type="checkbox" id="vimeoPlaysinline" checked style="margin-right: 8px;">
            인라인 재생 (playsinline)
          </label>
        </div>
        
        <button onclick="generateVimeoCode()" class="glass-btn-blue">
          HTML 코드 생성
        </button>
        
        <div class="generated-code" style="display: none;">
          <label>생성된 HTML 코드:</label>
          <textarea id="generatedCode" readonly class="glass-textarea"></textarea>
          <button onclick="copyGeneratedCode()" class="glass-btn-green">
            📋 코드 복사
          </button>
        </div>
      </div>
    </div>
  </site-modal>

  <script>
    // 프리셋 설정
    function setPreset(type, button) {
      // 기존 활성화된 버튼 비활성화
      document.querySelectorAll('.btn-preset').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // 현재 버튼 활성화
      button.classList.add('active');
      
      // 프리셋 타입에 따른 입력값 설정
      const presets = {
        selective: {
          find: '/250617\\/(23|25)\\.(jpg|png)/g',
          replace: '250701/$1.$2'
        },
        date: {
          find: '250617',
          replace: '250701'
        },
        image: {
          find: '/images/old/',
          replace: '/images/new/'
        }
      };
      
      // 입력 필드에 프리셋 값 설정
      document.getElementById('findText').value = presets[type].find;
      document.getElementById('replaceText').value = presets[type].replace;
    }

    // 코드 변환 함수
    function transformCode() {
      const originalCode = document.getElementById('originalCode').value;
      const findText = document.getElementById('findText').value;
      const replaceText = document.getElementById('replaceText').value;
      const newCodeTextarea = document.getElementById('newCode');
      const resultContent = document.getElementById('resultContent');
      
      if (!originalCode.trim()) {
        alert('기존 코드를 입력해주세요.');
        return;
      }
      
      let modifiedCode = originalCode;
      
      // 현재 입력된 찾기/바꾸기 처리
      if (findText && replaceText) {
        try {
          // 정규식 패턴 처리
          let pattern = findText;
          let flags = 'g';
          
          // /pattern/flags 형식인 경우에만 정규식으로 처리
          const regexMatch = findText.match(/^\/(.+)\/([gimuy]*)$/);
          if (regexMatch) {
            pattern = regexMatch[1];
            flags = regexMatch[2] || 'g';
            modifiedCode = modifiedCode.replace(new RegExp(pattern, flags), replaceText);
          } else {
            // 일반 텍스트는 전역 치환
            modifiedCode = modifiedCode.split(pattern).join(replaceText);
          }
        } catch (error) {
          console.error('정규식 에러:', error);
          alert('잘못된 정규식 패턴입니다.');
          return;
        }
      }
      
      // 추가된 찾기/바꾸기 항목들 처리
      const additionalItems = document.querySelectorAll('.glass-find-replace-item');
      additionalItems.forEach(item => {
        const findValue = item.querySelector('.glass-find-replace-item-find').value;
        const replaceValue = item.querySelector('.glass-find-replace-item-replace').value;
        
        try {
          // 정규식 패턴 처리
          let pattern = findValue;
          let flags = 'g';
          
          // /pattern/flags 형식인 경우에만 정규식으로 처리
          const regexMatch = findValue.match(/^\/(.+)\/([gimuy]*)$/);
          if (regexMatch) {
            pattern = regexMatch[1];
            flags = regexMatch[2] || 'g';
            modifiedCode = modifiedCode.replace(new RegExp(pattern, flags), replaceValue);
          } else {
            // 일반 텍스트는 전역 치환
            modifiedCode = modifiedCode.split(pattern).join(replaceValue);
          }
        } catch (error) {
          console.error('정규식 에러:', error);
        }
      });
      
      // 결과 표시
      newCodeTextarea.value = modifiedCode;
      newCodeTextarea.readOnly = false;  // 직접 수정 가능하도록
      
      // 변경점 비교 표시
      showDiff(originalCode, modifiedCode);
      
      // 최종 결과 표시
      resultContent.innerHTML = `<pre class="glass-code-text">${escapeHtml(modifiedCode)}</pre>`;
    }

    // 차이점 표시 함수
    function showDiff(original, modified) {
      const originalLines = original.split('\n');
      const modifiedLines = modified.split('\n');
      const diffContent = document.getElementById('diffContent');
      const diffStats = document.getElementById('diffStats');
      
      let html = '';
      let addedCount = 0;
      let removedCount = 0;
      
      const maxLines = Math.max(originalLines.length, modifiedLines.length);
      
      for (let i = 0; i < maxLines; i++) {
        const originalLine = originalLines[i] || '';
        const modifiedLine = modifiedLines[i] || '';
        
        if (originalLine !== modifiedLine) {
          if (originalLine) {
            html += `<div class="diff-line removed"><span class="diff-mark">-</span><span class="diff-text">${escapeHtml(originalLine)}</span></div>`;
            removedCount++;
          }
          if (modifiedLine) {
            html += `<div class="diff-line added"><span class="diff-mark">+</span><span class="diff-text">${escapeHtml(modifiedLine)}</span></div>`;
            addedCount++;
          }
        } else if (originalLine.trim()) {
          html += `<div class="diff-line"><span class="diff-mark"> </span><span class="diff-text">${escapeHtml(originalLine)}</span></div>`;
        }
      }
      
      // 변경점이 있을 때만 통계 표시
      if (addedCount > 0 || removedCount > 0) {
        diffStats.style.display = 'flex';
        document.getElementById('addedLines').textContent = addedCount;
        document.getElementById('removedLines').textContent = removedCount;
        diffContent.innerHTML = html;
      } else {
        diffStats.style.display = 'none';
        diffContent.innerHTML = '<div class="diff-empty">변경된 내용이 없습니다.</div>';
      }
    }

    // HTML 이스케이프 함수
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // 전체 초기화 함수
    function clearAll() {
      document.getElementById('originalCode').value = '';
      document.getElementById('newCode').value = '';
      document.getElementById('findText').value = '';
      document.getElementById('replaceText').value = '';
      document.getElementById('additionalFindReplace').innerHTML = '';
      document.getElementById('additionalFindReplace').style.display = 'none';
      document.getElementById('diffStats').style.display = 'none';
      document.getElementById('diffContent').innerHTML = '변경된 내용이 없습니다.';
      document.getElementById('resultContent').innerHTML = '변환된 최종 코드가 여기에 표시됩니다.';
      
      // URL 입력 모드로 전환
      const manualInputBtn = document.getElementById('manualInputBtn');
      const urlControls = document.getElementById('urlControls');
      const transformControls = document.getElementById('transformControls');
      const urlHint = document.getElementById('urlHint');
      const transformHint = document.getElementById('transformHint');
      
      manualInputBtn.style.background = '';
      manualInputBtn.style.color = '';
      urlControls.style.display = 'flex';
      transformControls.style.display = 'none';
      urlHint.style.display = 'block';
      transformHint.style.display = 'none';
    }

    // 실시간 미리보기 (옵션)
    document.getElementById('originalCode').addEventListener('input', function() {
      const findText = document.getElementById('findText').value;
      const replaceText = document.getElementById('replaceText').value;
      
      if (this.value && findText && replaceText) {
        // 자동 변환은 사용자가 원할 때만 활성화
        // transformCode();
      }
    });

    // 바꿀 텍스트 자동 완성 기능
    document.getElementById('replaceText').addEventListener('input', function() {
      const findText = document.getElementById('findText').value;
      const replaceText = this.value;
      
      // 찾을 텍스트가 정규식 패턴이고, 바꿀 텍스트가 간단한 형태일 때 자동 완성
      if (findText.includes('/(') && findText.includes('|') && findText.includes(')\\.(') && replaceText && !replaceText.includes('$')) {
        // 현재 커서 위치 저장
        const cursorPos = this.selectionStart;
        const originalLength = replaceText.length;
        
        // $1.$2가 없고 단순한 텍스트만 있는 경우
        if (!replaceText.includes('$1') && !replaceText.includes('$2')) {
          const newValue = replaceText + '/$1.$2';
          this.value = newValue;
          
          // 커서를 추가된 텍스트 앞에 위치시킴 (사용자가 입력한 부분 끝)
          this.setSelectionRange(originalLength, originalLength);
        }
      }
    });

    // 페이지 로드 시 기본값 설정
    document.addEventListener('DOMContentLoaded', function() {
      // 선택적 변경 프리셋을 기본으로 설정
      const selectiveButton = document.querySelector('.btn-preset:first-child');
      setPreset('selective', selectiveButton);
    });

    // 미리보기 기능
    function previewCode() {
      const originalCode = document.getElementById('originalCode').value;
      const newCode = document.getElementById('newCode').value || originalCode;
      if (!originalCode.trim()) {
        alert('기존 코드를 입력해주세요.');
        return;
      }
      
      // URL 입력필드에서 베이스 경로 추출
      const pageUrl = getCurrentUrl();
      let basePath = '';
      if (pageUrl && pageUrl.startsWith('http')) {
        try {
          basePath = new URL(pageUrl).origin;
        } catch (e) {
          console.log('URL 파싱 실패:', e);
        }
      }
      
      // 이미지 경로를 절대경로로 변환
      let previewCode = newCode;
      if (basePath) {
        // src="상대경로"를 src="절대경로"로 변환
        previewCode = previewCode.replace(/src="(?!https?:\/\/|\/\/|data:)([^"]+)"/g, function(match, relativePath) {
          // 상대경로가 /로 시작하면 basePath 뒤에 바로 붙이고, 아니면 /를 추가
          if (relativePath.startsWith('/')) {
            return 'src="' + basePath + relativePath + '"';
          } else {
            return 'src="' + basePath + '/' + relativePath + '"';
          }
        });
      }
      
      // position: absolute를 position: static으로 변경하고 관련 속성 정리
      previewCode = previewCode.replace(/position:\s*absolute/g, 'position: static');
      previewCode = previewCode.replace(/position:\s*fixed/g, 'position: static');
      
      // absolute/fixed 포지셔닝과 함께 사용되던 불필요한 속성들 제거
      // 속성 뒤에 세미콜론이 있는 경우
      previewCode = previewCode.replace(/;\s*top:\s*[^;]+/g, '');
      previewCode = previewCode.replace(/;\s*left:\s*[^;]+/g, '');
      previewCode = previewCode.replace(/;\s*right:\s*[^;]+/g, '');
      previewCode = previewCode.replace(/;\s*bottom:\s*[^;]+/g, '');
      previewCode = previewCode.replace(/;\s*z-index:\s*[^;]+/g, '');
      
      // 속성이 맨 앞에 오는 경우 (top: 10px; 같은 형태)
      previewCode = previewCode.replace(/top:\s*[^;]+;\s*/g, '');
      previewCode = previewCode.replace(/left:\s*[^;]+;\s*/g, '');
      previewCode = previewCode.replace(/right:\s*[^;]+;\s*/g, '');
      previewCode = previewCode.replace(/bottom:\s*[^;]+;\s*/g, '');
      previewCode = previewCode.replace(/z-index:\s*[^;]+;\s*/g, '');
      
      // 새 창으로 미리보기 열기
      const previewWindow = window.open('about:blank', '_blank', 'width=1200,height=800,scrollbars=yes');
      
      setTimeout(() => {
        previewWindow.document.head.innerHTML = 
          '<link rel="stylesheet" href="assets/css/common.css">' +
          '<style>body { margin: 0; }</style>';
        
        previewWindow.document.body.className = 'glass-preview-wrapper';
        previewWindow.document.body.innerHTML = 
          '<div id="mediaStats" class="glass-media-stats">미디어 파일을 확인하는 중...</div>' +
          '<div id="mediaGallery" class="glass-gallery"></div>' +
          '<div id="previewContent" style="display: none;">' +
          previewCode +
          '</div>';
        
        setTimeout(() => {
          // DOM 순서대로 이미지와 영상을 함께 수집 (modal 제외)
          const allMediaElements = previewWindow.document.querySelectorAll('img, video');
          const allMedia = [];
          
          // DOM 순서대로 미디어 요소들 수집 (modal_wrap 내부 제외)
          allMediaElements.forEach((element) => {
            // modal_wrap 내부에 있는지 확인
            const isInModal = element.closest('.modal_wrap, .modal-wrap, .modal, [class*="modal"]');
            if (isInModal) {
              return; // 모달 내부면 제외
            }
            
            if (element.tagName === 'IMG') {
              allMedia.push({ element: element, type: 'image' });
            } else if (element.tagName === 'VIDEO') {
              allMedia.push({ element: element, type: 'video' });
            }
          });
          
          const images = allMedia.filter(media => media.type === 'image');
          const videos = allMedia.filter(media => media.type === 'video');
          
          // 미리 생성된 미디어 갤러리 요소 사용
          const mediaGallery = previewWindow.document.getElementById('mediaGallery');
          
          // 영상 카운터 초기화
          let videoCounter = 0;
          
          // 통합 순번으로 처리
          allMedia.forEach((media, index) => {
            const element = media.element;
            const src = element.getAttribute('src') || '';
            const isAbsolute = src.startsWith('http') || src.startsWith('//');
            const isVideo = media.type === 'video';
            
            // 파일명 처리 - 영상은 순차적 이름 사용
            let filename;
            if (isVideo) {
              videoCounter++;
              filename = 'video_' + String(videoCounter).padStart(2, '0');
            } else {
              filename = src.split('/').pop() || src.split('?')[0].split('/').pop() || '';
              // 파일명 전체 표시 (줄임표 처리 제거)
            }
            
            // wrapper 생성
            const wrapper = previewWindow.document.createElement('div');
            wrapper.className = 'glass-media-wrapper ' + (isVideo ? 'glass-media-wrapper-video' : 'glass-media-wrapper-image');
            
            // 새로운 미디어 요소 생성 (복사)
            const newElement = element.cloneNode(true);
            newElement.className = 'glass-media-element';
            
            // 파일명 뱃지 생성
            const badge = previewWindow.document.createElement('div');
            badge.className = 'glass-media-badge ' + (isAbsolute ? 'glass-media-badge-success' : 'glass-media-badge-warning');
            badge.textContent = filename || (isVideo ? 'video' : 'image');
            
            // 로딩/에러 상태 표시용 오버레이 생성
            const overlay = previewWindow.document.createElement('div');
            overlay.className = 'glass-media-overlay';
            overlay.innerHTML = '⏳ 로딩 중...';
            
            // 이미지 로드 성공/실패 처리
            if (!isVideo) {
              newElement.onload = function() {
                // 로드 성공 시 오버레이 제거
                if (overlay.parentNode) {
                  overlay.remove();
                }
              };
              
              newElement.onerror = function() {
                // 로드 실패 시 에러 표시
                overlay.className = 'glass-media-overlay glass-media-overlay-error';
                overlay.innerHTML = '<p>❌ 로드 실패</p><small class="glass-media-overlay-text">이미지를 찾을 수 없습니다</small>';
                
                // wrapper 테두리 변경은 CSS로 처리
                wrapper.style.borderStyle = 'dashed';
                
                // 파일명 뱃지도 에러 색상으로 변경
                badge.className = 'glass-media-badge glass-media-badge-error';
              };
            } else {
              // 비디오는 로드되면 오버레이 제거
              newElement.onloadeddata = function() {
                if (overlay.parentNode) {
                  overlay.remove();
                }
              };
              
              newElement.onerror = function() {
                // 비디오 로드 실패 시
                overlay.className = 'glass-media-overlay glass-media-overlay-error';
                overlay.innerHTML = '<p>❌ 재생 불가</p><small class="glass-media-overlay-text">비디오 파일 오류</small>';
                
                wrapper.style.borderStyle = 'dashed';
                badge.className = 'glass-media-badge glass-media-badge-error';
              };
            }
            
            // 순번 뱃지 생성
            const numberBadge = previewWindow.document.createElement('div');
            numberBadge.className = 'glass-media-number ' + (isVideo ? 'glass-media-number-video' : 'glass-media-number-image');
            numberBadge.textContent = index + 1;
            
            // wrapper에 요소들 추가
            wrapper.appendChild(newElement);
            wrapper.appendChild(overlay); // 로딩/에러 오버레이 추가
            wrapper.appendChild(badge);
            wrapper.appendChild(numberBadge);
            
            // 갤러리에 wrapper 추가
            mediaGallery.appendChild(wrapper);
          });
          
          // 갤러리는 이미 HTML에서 생성되어 있으므로 별도 추가 불필요
          
          // 깔끔한 통계 표시 (상단)
          const mediaStats = previewWindow.document.getElementById('mediaStats');
          const totalCount = images.length + videos.length;
          
          if (totalCount > 0) {
            // 간단한 한 줄 스타일 HTML 생성
            let statsText = '<span class="highlight">총 미디어 파일 ' + totalCount + '개</span>';
            
            if (images.length > 0 && videos.length > 0) {
              statsText += '<span class="separator">•</span>이미지 (' + images.length + '개)<span class="separator">•</span>영상 (' + videos.length + '개)';
            } else if (images.length > 0) {
              statsText += '<span class="separator">•</span>이미지 (' + images.length + '개)';
            } else if (videos.length > 0) {
              statsText += '<span class="separator">•</span>영상 (' + videos.length + '개)';
            }
            
            statsText += '<span class="separator">•</span>총 용량 <span class="highlight" id="totalSize">계산 중...</span>';
            
            let statsHTML = 
              '<div class="glass-media-stats-line">' +
              statsText +
              '</div>';
            
            mediaStats.innerHTML = statsHTML;
            
            // 미디어 파일 용량 계산
            calculateMediaSizes(previewWindow, allMedia);
          } else {
            mediaStats.innerHTML = 
              '<div class="glass-no-media">' +
              '<div class="glass-no-media-icon">📭</div>' +
              '<div class="glass-no-media-title">미디어 파일이 발견되지 않았습니다</div>' +
              '<div class="glass-no-media-desc">이미지나 영상이 포함된 페이지인지 확인해주세요</div>' +
              '</div>';
          }
        }, 100);
      }, 100);
    }

    // 미디어 파일 용량 계산 함수
    function calculateMediaSizes(previewWindow, allMedia) {
      let totalSize = 0;
      let completedRequests = 0;
      let successfulRequests = 0;
      const totalRequests = allMedia.length;
      
      // 용량을 읽기 쉬운 형태로 변환하는 함수
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
      
      // 용량 정보 업데이트 함수 (간단한 한 줄 스타일)
      function updateSizeInfo() {
        const totalSizeElement = previewWindow.document.getElementById('totalSize');
        if (!totalSizeElement) return;
        
        if (completedRequests === totalRequests) {
          if (successfulRequests > 0) {
            const avgSize = totalSize / successfulRequests;
            const estimatedTotal = avgSize * totalRequests;
            
            // 신뢰성 계산
            const accuracy = Math.round((successfulRequests / totalRequests) * 100);
            
            const displaySize = formatFileSize(successfulRequests < totalRequests ? estimatedTotal : totalSize);
            totalSizeElement.textContent = displaySize;
          } else {
            totalSizeElement.textContent = '계산 실패';
          }
        } else {
          const progress = Math.round((completedRequests / totalRequests) * 100);
          totalSizeElement.textContent = '계산 중... ' + progress + '%';
        }
      }
      
      // 각 미디어 파일의 용량 확인
      allMedia.forEach((media, index) => {
        const src = media.element.getAttribute('src') || '';
        
        if (!src || (!src.startsWith('http') && !src.startsWith('//'))) {
          // 상대 경로나 잘못된 URL인 경우
          completedRequests++;
          updateSizeInfo();
          return;
        }
        
        // HEAD 요청으로 파일 크기 확인
        fetch(src, { 
          method: 'HEAD',
          mode: 'cors',
          cache: 'no-cache'
        })
        .then(response => {
          completedRequests++;
          
          if (response.ok) {
            const contentLength = response.headers.get('content-length');
            if (contentLength) {
              const size = parseInt(contentLength, 10);
              if (!isNaN(size) && size > 0) {
                totalSize += size;
                successfulRequests++;
              }
            }
          }
          
          updateSizeInfo();
        })
        .catch(error => {
          // CORS 오류나 네트워크 오류 시
          completedRequests++;
          
          // 이미지인 경우 대안적 방법 시도 (자연스러운 크기 기반 추정)
          if (media.type === 'image') {
            const img = media.element;
            if (img.naturalWidth && img.naturalHeight) {
              // 대략적인 크기 추정 (해상도 기반)
              const estimatedSize = img.naturalWidth * img.naturalHeight * 3; // RGB 기준 대략 추정
              totalSize += estimatedSize;
              successfulRequests++;
            }
          }
          
          updateSizeInfo();
        });
      });
      
      // 요청이 없는 경우 즉시 업데이트
      if (totalRequests === 0) {
        updateSizeInfo();
      }
    }

    // URL 값 가져오기 (input 또는 select에서)
    function getCurrentUrl() {
      const urlInput = document.getElementById('pageUrl');
      const urlSelect = document.getElementById('pageUrlSelect');
      
      if (urlInput.style.display !== 'none') {
        return urlInput.value.trim();
      } else {
        return urlSelect.value.trim();
      }
    }

    // 수동 입력 모드 토글
    function toggleManualInput() {
      const urlInput = document.getElementById('pageUrl');
      const urlSelect = document.getElementById('pageUrlSelect');
      const toggleBtn = document.getElementById('manualInputBtn');
      const autoControls = document.getElementById('autoControls');
      const manualControls = document.getElementById('manualControls');
      
      if (urlInput.style.display !== 'none') {
        // Input → Select로 변경
        urlInput.style.display = 'none';
        urlSelect.style.display = 'block';
        toggleBtn.innerHTML = '⌨️';
        toggleBtn.setAttribute('data-tooltip', '직접 입력');
        
        // 현재 input 값이 있다면 select에서 비슷한 도메인 찾아서 선택
        const currentUrl = urlInput.value.trim();
        if (currentUrl) {
          const domain = currentUrl.replace(/^https?:\/\//, '').split('/')[0];
          const options = urlSelect.querySelectorAll('option');
          
          for (let option of options) {
            if (option.value && option.value.includes(domain)) {
              urlSelect.value = option.value;
              break;
            }
          }
        }

      } else {
        // Select → Input으로 변경
        urlSelect.style.display = 'none';
        urlInput.style.display = 'block';
        toggleBtn.innerHTML = '✏️';
        toggleBtn.setAttribute('data-tooltip', '수동 입력');
        
        // 현재 select 값이 있다면 input에 설정
        if (urlSelect.value) {
          urlInput.value = urlSelect.value;
        }
      }

      // 버튼 상태 토글
      const hasManualCode = document.getElementById('originalCode').value.trim().length > 0;
      autoControls.style.display = hasManualCode ? 'none' : 'flex';
      manualControls.style.display = hasManualCode ? 'flex' : 'none';
    }

    // 코드 입력 처리
    function handleCodeInput(value) {
      const autoControls = document.getElementById('autoControls');
      const manualControls = document.getElementById('manualControls');
      
      if (value.trim()) {
        // 코드가 입력된 경우
        autoControls.style.display = 'none';
        manualControls.style.display = 'flex';
      } else {
        // 코드가 비어있는 경우
        autoControls.style.display = 'flex';
        manualControls.style.display = 'none';
      }
    }

    // 페이지 콘텐츠 가져오기
    function fetchPageContent() {
      const url = document.getElementById('pageUrl').value;
      const urlSelect = document.getElementById('pageUrlSelect');
      const selectedUrl = urlSelect.style.display === 'none' ? url : urlSelect.value;
      
      if (!selectedUrl) {
        alert('URL을 입력하거나 사이트를 선택해주세요.');
        return;
      }
      
      // 여기에 프록시를 통한 페이지 콘텐츠 가져오기 로직 추가
      // ...
      
      // 변환 컨트롤 숨기기
      document.querySelector('.transform-controls').style.display = 'none';
    }

    // 상대경로를 절대경로로 변환하는 함수
    function makeAbsoluteUrl(url, baseUrl = null) {
      // 이미 절대경로면 그대로 반환
      if (url.startsWith('http://') || url.startsWith('https://') || url.startsWith('//')) {
        return url;
      }
      
      // baseUrl이 제공되지 않았다면 URL 입력필드에서 추출 시도
      if (!baseUrl) {
        const pageUrl = getCurrentUrl();
        if (pageUrl && pageUrl.startsWith('http')) {
          try {
            baseUrl = new URL(pageUrl).origin;
          } catch (e) {
            // URL 파싱 실패시 그대로 반환
            return url;
          }
        } else {
          return url; // 베이스 URL이 없으면 원본 반환
        }
      }
      
      // 베이스 경로 마지막 슬래시 제거
      baseUrl = baseUrl.replace(/\/$/, '');
      
      // URL이 /로 시작하면 절대경로, 아니면 상대경로
      if (url.startsWith('/')) {
        return baseUrl + url;
      } else {
        return baseUrl + '/' + url;
      }
    }

    // 레이지로딩 수정 함수
    function processLazyLoading(htmlContent) {
      // 기본적으로 레이지로딩 처리를 활성화 (체크박스가 없으므로)
      // if (!document.getElementById('fixLazyLoad').checked) {
      //   return htmlContent;
      // }
      
      let processedContent = htmlContent;
      
      // ec-data-src → src 변환 (절대경로로)
      processedContent = processedContent.replace(/ec-data-src="([^"]*)"/g, (match, url) => {
        const absoluteUrl = makeAbsoluteUrl(url);
        return `src="${absoluteUrl}"`;
      });
      
      // data-src → src 변환 (기존 src가 없거나 placeholder인 경우)
      processedContent = processedContent.replace(/<img([^>]*?)data-src="([^"]*)"([^>]*?)(?:src="[^"]*")?([^>]*?)>/g, 
        (match, before, dataSrc, middle, after) => {
          // 기존 src가 의미있는 값인지 확인
          const existingSrcMatch = match.match(/src="([^"]*)"/);
          if (existingSrcMatch && existingSrcMatch[1] && 
              !existingSrcMatch[1].includes('placeholder') && 
              !existingSrcMatch[1].includes('loading') &&
              !existingSrcMatch[1].includes('lazy') &&
              existingSrcMatch[1].length > 10) {
            return match; // 이미 유효한 src가 있으면 그대로 유지
          }
          
          const absoluteUrl = makeAbsoluteUrl(dataSrc);
          return `<img${before}src="${absoluteUrl}"${middle}${after}>`;
        });
      
      // data-original → src 변환 (절대경로로)
      processedContent = processedContent.replace(/<img([^>]*?)data-original="([^"]*)"([^>]*?)(?:src="[^"]*")?([^>]*?)>/g, 
        (match, before, dataOriginal, middle, after) => {
          const absoluteUrl = makeAbsoluteUrl(dataOriginal);
          return `<img${before}src="${absoluteUrl}"${middle}${after}>`;
        });
      
      // 비디오 태그의 lazy-src → src 변환 (절대경로로)
      processedContent = processedContent.replace(/lazy-src="([^"]*)"/g, (match, lazySrc) => {
        const absoluteUrl = makeAbsoluteUrl(lazySrc);
        return `src="${absoluteUrl}"`;
      });
      
      // 비디오 태그의 data-src → src 변환 (이미 src가 없는 경우만)
      processedContent = processedContent.replace(/<video([^>]*?)data-src="([^"]*)"([^>]*?)>/g, 
        (match, before, dataSrc, after) => {
          // 이미 src가 있는지 확인
          if (match.includes('src="') && !match.includes('src=""')) {
            return match; // 이미 유효한 src가 있으면 그대로 유지
          }
          
          const absoluteUrl = makeAbsoluteUrl(dataSrc);
          return `<video${before}src="${absoluteUrl}"${after}>`;
        });
      
      return processedContent;
    }

    // 불필요한 data 속성 제거 함수  
    function removeUnnecessaryDataAttrs(htmlContent) {
      // 기본적으로 불필요한 속성 제거를 활성화 (체크박스가 없으므로)
      // if (!document.getElementById('removeDataAttrs').checked) {
      //   return htmlContent;
      // }
      
      let processedContent = htmlContent;
      
      // 처리된 data 속성들 제거
      const attrsToRemove = [
        'ec-data-src', 'data-src', 'data-original', 'lazy-src',
        'data-lazy', 'data-loading', 'data-placeholder', 'data-srcset'
      ];
      
      attrsToRemove.forEach(attr => {
        const regex = new RegExp(`\\s${attr}="[^"]*"`, 'g');
        processedContent = processedContent.replace(regex, '');
      });
      
      return processedContent;
    }

    // 텍스트 영역 붙여넣기 이벤트 처리
    document.getElementById('originalCode').addEventListener('paste', function(e) {
      setTimeout(() => {
        let content = this.value;
        
        // 레이지로딩 처리
        content = processLazyLoading(content);
        
        // 불필요한 속성 제거
        content = removeUnnecessaryDataAttrs(content);
        
        // 처리된 내용 다시 설정
        if (content !== this.value) {
          this.value = content;
          console.log('✅ 레이지로딩 및 데이터 속성 처리 완료');
        }
      }, 10);
    });

    // URL 입력 필드에서 엔터키 처리
    document.getElementById('pageUrl').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        fetchPageContent(); // 프록시 시도, 실패 시 자동으로 수동 복사 안내
      }
    });

    // URL 셀렉트 박스에서 변경 시 처리
    document.getElementById('pageUrlSelect').addEventListener('change', function(e) {
      if (this.value) {
        // 선택된 값이 있으면 자동으로 프록시 요청 (옵션)
        // fetchPageContent();
      }
    });

    // 찾기/바꾸기 항목 추가 함수
    function addFindReplace() {
      const findText = document.getElementById('findText').value;
      const replaceText = document.getElementById('replaceText').value;
      
      if (!findText || !replaceText) {
        alert('찾기/바꾸기 항목을 모두 입력해주세요.');
        return;
      }
      
      const additionalFindReplace = document.getElementById('additionalFindReplace');
      additionalFindReplace.style.display = 'block';
      
      // 새로운 찾기/바꾸기 항목 생성
      const newItem = document.createElement('div');
      newItem.className = 'glass-find-replace-item';
      newItem.innerHTML = `
        <div class="glass-find-replace-item-content">
          <input type="text" class="glass-find-replace-item-find" value="${escapeHtml(findText)}" />
          <input type="text" class="glass-find-replace-item-replace" value="${escapeHtml(replaceText)}" />
          <button class="btn-remove" onclick="removeFindReplace(this)">&times;</button>
        </div>
      `;
      
      // 추가된 항목을 추가
      additionalFindReplace.appendChild(newItem);
      
      // 입력 필드 초기화 및 현재 활성화된 프리셋에 따른 값 자동 입력
      document.getElementById('replaceText').value = '';
      
      // 현재 활성화된 프리셋 찾기
      const activePreset = document.querySelector('.btn-preset.active');
      if (activePreset) {
        const presetType = activePreset.getAttribute('onclick').match(/setPreset\('(\w+)'/)[1];
        const presets = {
          selective: '/250617\\/(23|25)\\.(jpg|png)/g',
          date: '250617',
          image: '/images/old/'
        };
        document.getElementById('findText').value = presets[presetType];
      } else {
        document.getElementById('findText').value = '/250617\\/(23|25)\\.(jpg|png)/g';
      }
      
      document.getElementById('findText').focus();
    }

    // 찾기/바꾸기 항목 제거 함수
    function removeFindReplace(button) {
      const item = button.closest('.glass-find-replace-item');
      if (item) {
        item.remove();
        const additionalFindReplace = document.getElementById('additionalFindReplace');
        if (additionalFindReplace.children.length === 0) {
          additionalFindReplace.style.display = 'none';
        }
      }
    }

    // 결과 복사 함수
    function copyResult() {
      const resultContent = document.getElementById('resultContent').textContent;
      
      if (!resultContent.trim()) {
        alert('복사할 내용이 없습니다.');
        return;
      }
      
      navigator.clipboard.writeText(resultContent).then(() => {
        const copyBtn = document.querySelector('.copy-btn-sm');
        const originalText = copyBtn.textContent;
        
        copyBtn.textContent = '✓ 복사됨';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = originalText;
          copyBtn.classList.remove('copied');
        }, 2000);
      }).catch(() => {
        // 클립보드 API가 지원되지 않는 경우
        const textArea = document.createElement('textarea');
        textArea.value = resultContent;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        alert('클립보드에 복사되었습니다!');
      });
    }

  </script>

  <script src="assets/js/common.js" defer></script>
  <script src="assets/js/site-ui.js" defer></script>
</body>
</html> 